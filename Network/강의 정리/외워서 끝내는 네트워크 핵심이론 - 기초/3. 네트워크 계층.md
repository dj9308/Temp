# 3. 네트워크 계층



## IPv4 구조

- 32bit 주소 체계를 사용한다. 이는 8bit x 4이자 2의 8제곱이며, 범위로 따지면 0에서 255이다.
- IP 주소는 네트워크 ID와 호스트 ID로 나뉜다. 
- IPv4의 경우 32비트의 이진수로 표현되며, 이 32비트 중에서 앞쪽 비트부터 연속적인 1의 개수에 따라 네트워크 ID와 호스트 ID가 구분된다. 
- 네트워크 ID는 전체 네트워크에서 해당 호스트가 속한 네트워크를 식별하는 역할을 하며, 호스트 ID는 해당 호스트를 식별하는 역할을 한다. 
- 예를 들어, IP 주소가 192.168.1.10일 경우, 여기서 192.168.1은 네트워크 ID이며, 10은 호스트 ID이다. 따라서 이 주소는 192.168.1 네트워크의 10번 호스트를 나타낸다.
- 네트워크 ID와 호스트 ID로 나누는 것은 라우팅과 서브넷팅을 수행하기 위한 필수적인 작업이다.
  - 라우팅은 다른 네트워크로 패킷을 전송하는 것을 의미한다. 이 때, 패킷의 목적지 IP 주소를 보고 해당 목적지가 속한 네트워크를 파악해야 한다. 
  - 이를 위해서 IP 주소를 네트워크 ID와 호스트 ID로 나누어, 목적지 IP 주소의 네트워크 ID와 라우터의 인터페이스에 설정된 네트워크 ID를 비교하여 패킷을 전송할 방향을 결정한다.
  - 서브넷팅은 큰 네트워크를 여러 개의 작은 네트워크로 나누는 것을 의미한다. 이를 통해 네트워크를 더욱 효율적으로 관리할 수 있다. 
  - IP 주소를 네트워크 ID와 호스트 ID로 나누어 서브넷 마스크와 함께 사용하여, 각각의 작은 네트워크에 IP 주소를 할당할 수 있다.

![image-20230307211809660](C:\Users\dj930\AppData\Roaming\Typora\typora-user-images\image-20230307211809660.png)



## L3 Packet

- Packet이라는 말은 L3 IP Packet으로 외우는 것이 바람직하다.
- Header와 Payload로 나뉘며 이는 상대적인 분류이다.
- wireshark를 이용하여 네트워크 및 L3 Packet을 확인할 수 있다.  
- 패킷의 최대 크기는 MTU (Maximum Transmission Unit)이다.
  - MTU(Maximum Transmission Unit)는 네트워크에서 전송되는 패킷의 최대 크기를 나타내는 매개변수이다. 이 매개변수는 데이터 링크 계층에서 사용되며, 패킷이 전송될 때마다 라우터, 스위치 또는 다른 네트워크 장비에서 처리된다.
  - MTU는 패킷의 최대 크기를 결정하며, 이 크기는 전송되는 데이터마다 다를 수 있다. 예를 들어, 이더넷에서 MTU는 일반적으로 1500바이트로 설정되어 있지만, 다른 네트워크 기술에서는 이보다 크거나 작을 수 있다.
  - MTU의 크기는 전송 속도와 패킷 처리 속도에 영향을 미치며, MTU의 크기가 크면 데이터 전송 시간이 길어지지만, 한 번에 전송되는 데이터 양이 많아질 수 있다.
  - MTU 크기는 일반적으로 시스템 또는 장비에서 설정할 수 있으며, 이 값은 보통 장비의 기본값으로 설정된다.
  - MTU 값은 망 구성이나 장비 간 연결 상태가 변경될 때 조정되어야 할 수도 있다.
  - 대체로 L2 패킷의 MTU는 1500 바이트, L3 패킷의 MTU는 576 바이트이다.



## 패킷의 생성과 전달

#### 패킷 관련 객체 이름 

- 보내는 이 & 받는 이 : Process
- 상자 : Packet  (데이터를 패킷에 담는다)
- 현관 : Interface
- 택배 기사 : Gateway
- 집 : Host

#### 택배(데이터)가 보내지는 과정

1. 물건을 상자에 담는다 - 데이터를 패킷에 담는다.
2. 집의 현관을 나서서 기사님께 전달한다 - Host의 Interface를 타고 게이트웨이에 전달한다. 
3. 기사는 택배를 모아서 전달한다 - 패킷을 라우팅한다.
4. 패킷은 IPv4의 목적지를 보고 상대방의 host에 전달한다
5. 이름을 확인하고 택배를 전달한다 - Port 번호를 확인하고 패킷을 전달한다

#### 정리

- Socket 
  - 커널 모드 프로토콜을 추상화한, 유저 모드 어플리케이션이 접근할 수 있도록 추상화시켜준 인터페이스 및 일종의 파일.
  - 컴퓨터 네트워크에서 두 개의 프로세스 간에 양방향 통신을 가능하게 하는 일종의 인터페이스.
  - Socket은 TCP Socket이라고도 한다.
  - 데이터를 Socket에 대고 Write(Send)를 해서 tcp 영역에 들어가면 data 앞에 tcp 헤더가 붙는다. 이 단위를 Segment라 한다.
  - IP 레이어에 들어가면 Ip 헤더가 붙으며, 이더넷 레이어에 들어가면 이더넷 프레임 헤더가 붙는다.
  - 이렇게 붙여진 단위로 데이터가 나간다.
- Gateway
  - 네트워크 상에서 서로 다른 프로토콜 또는 네트워크 간의 통신을 중개하는 역할을 한다.
  - 여러 계층의 프로토콜 스택을 지원하며, 라우팅, 패킷 변환, 프로토콜 변환 등의 작업을 수행한다.