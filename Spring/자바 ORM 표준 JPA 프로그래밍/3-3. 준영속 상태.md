# 3-3. 준영속 상태



## 정의 및 특징

---

- 영속 상태는 persist 호출된 상태(CUD) 또는 DB 조회 후 1차 캐시에 올라간 상태(조회)라고 할 수 있다.
- 준영속 상태란 영속 상태의 Entity가 영속성 컨텍스트에서 분리된(detached) 상태이다.
- 영속성 컨텍스트가 제공하는 기능을 사용 못한다.(쓰기 지연, Dirty Checking 등)
- 준영속화된 객체는 1차 캐시에서 삭제된다.



## 준영속 상태로 만드는 방법

---

1. em.detach(entity) : 특정 엔티티만 준영속 상태로 전환
2. em.clear() : 영속성 컨텍스트를 완전히 초기화
3. em.close() : 영속성 컨텍스트를 종료 

※ 영속화된 객체를 준영속 상태로 변경 시, 해당 객체는 1차 캐시에서 지워지기 때문에 변경 감지(Dirty Checking)를 사용하지 못한다.

※ 아래 로그의 ①번 부분에서 처음 select 조회 후 준영속 상태로 해당 객체를 설정한 뒤 다시 select 조회 시 1차 캐시에 해당 객체가 없기 때문에 ②번 로그처럼 select 쿼리가 한 번 더 보내지는 것이다.

![image-20230130202054348](C:\Users\dj930\AppData\Roaming\Typora\typora-user-images\image-20230130202054348.png)