# 5-1. 단방향 연관 관계



## 목표

- 객체와 테이블 연관 관계의 차이를 이해
- 객체의 참조와 테이블의 외래 키를 매핑
- 용어 이해
  - 방향 (Direction) : 단방향, 양방향
  - 다중성 (Multiplicity) : 다대일(N:1), 일대다(1:N), 일대일(1:1) 다대다(N:M)을 이해
  - 연관 관계의 주인(Owner) : 객체 양방향 연관 관계는 관리가 필요



## 연관 관계 매핑 시 문제점 

객체를 테이블에 맞추어 데이터 중심으로 모델링 하면, 협력 관계를 만들 수 없다.

- 테이블은 외래 키로 조인을 사용해서 연관된 테이블을 찾는다.
- 객체는 참조를 사용해서 연관된 객체를 찾는다.
- 테이블과 객체 사이에는 이런 큰 간격이 있다.



## 단방향 및 양방향 연관 관계

### 단방향 연관 관계

![image-20230131134454857](C:\Users\dj930\AppData\Roaming\Typora\typora-user-images\image-20230131134454857.png)

참조를 한 객체만 걸어서 참조가 걸린 객체를 기준으로 조회하면 된다.




### 양방향 연관 관계 

![image-20230131135613154](C:\Users\dj930\AppData\Roaming\Typora\typora-user-images\image-20230131135613154.png)

테이블 연관 관계는 단방향 때와 같다. 테이블 연관 관계는 방향 자체가 없기 때문이다. 외래 키 하나만 있으면 테이블은 양쪽 다 조회할 수 있다. 하지만 객체는 참조로 연관 관계를 지정하기 때문에 외래 키로 객체의 연관 관계를 알 수가 없다. 때문에 양방향으로 객체의 연관 관계를 설정하려면 서로 참조를 걸어야 한다.

### 연관 관계의 주인과 mappedBy

- mappedBy = JPA의 멘탈 붕괴 난이도

- mappedBy는 처음에는 이해하기 어렵다.

- 객체와 테이블 간 연관 관계를 맺는 차이를 이해해야 한다.

  - 객체 연관관계 = 2개
    - 회원 -> 팀 연관관계 1개 (단방향)
    - 팀 -> 회원 연관관계 1개 (단방향)
  - 테이블 연관관계 = 1개
    - 회원 <-> 팀의 연관관계 1개 (양방향 또는 무방향)

- 객체의 양방향 관계는 사실 양방향 관계가 아니라 서로 다른 단방향 관계 두 개다.

- 객체를 양방향으로 참조하려면 단방향 연관관계를 두 개 만들어야 한다.

  ![image-20230131140536484](C:\Users\dj930\AppData\Roaming\Typora\typora-user-images\image-20230131140536484.png)

### 테이블의 양방향 연관관계

- 테이블은 외래 키 하나로 두 테이블의 연관관계를 관리한다.

- MEMBER.TEAM_ID 외래 키 하나로 양방향 연관관계를 가질 수 있다. (양쪽으로 조인할 수 있다.)
  ```mysql
  SELECT * FROM MEMBER M JOIN TEAM T ON M.TEAM_ID = T.TEAM_ID;
  SELECT * FROM TEAM T JOIN MEMBER M ON M.TEAM_ID = T.TEAM_ID;
  ```

- 테이블은 외래 키 하나로 두 개를 관리할 수 있는데 객체는 외래 키로 관리할 수 없기 때문에 객체 각각 관리를 해야 하는 문제가 생긴다.

### 연관 관계의 주인(Owner)

- 객체의 두 관계 중 하나를 주인으로 지정해야 한다.
- 연관관계의 주인만이 외래 키를 관리한다.(등록, 수정)
- 주인이 아닌 쪽은 읽기만 가능하다. (set으로 값을 넣어봐야 전혀 바뀌는 것이 없다.)
- 주인은 mappedBy 속성을 사용하면 안된다.
- 주인이 아니면 mappedBy 속성으로 주인을 지정한다.
