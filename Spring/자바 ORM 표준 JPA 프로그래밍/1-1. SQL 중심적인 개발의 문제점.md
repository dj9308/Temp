# 2. SQL 중심적인 개발의 문제점

지금 시대는 객체를 관계형 DB에 관리하는 시대이다. 객체를 관계형 DB에 보관하려면 엄청난 SQL을 사용해야 한다. 여기서 SQL에 의존적인 개발을 피하기 어려우며, 문제점 또한 발현된다. 문제점은 다음과 같다.

1. CRUD 할 때마다 쿼리를 반복해서 작성해야 한다.
2. 객체에 필드를 하나라도 추가하면 관련된 쿼리를 전부 바꿔야 한다.

또한 객체와 관계형 데이터베이스 간 패러다임의 불일치가 일어난다. 객체 지향 프로그래밍은 추상화, 캡슐화, 정보은닉, 다형성 등 시스템의 복잡성을 제어할 수 있는 다양한 장치들을 제공한다. 그리고 데이터를 저장하는데 NoSQL, File 등 여러 저장 방법이 있지만, 약 90%는 관계형 데이터베이스를 이용한다. 객체를 관계형 데이터베이스에 저장하는 구조는 다음과 같다.

![image-20230124193713743](C:\Users\dj930\AppData\Roaming\Typora\typora-user-images\image-20230124193713743.png)

정리하면, 개발자는 객체를 SQL로 바꿔서 RDB에 전달해야 한다.

객체와 관계형 데이터베이스의 차이는 다음과 같다.

1. 상속

   - 객체는 상속 관계가 존재하나, DB Table은 상속 관계가 존재하지 않는다. 이 간극을 메우기 위해, Table을 super, sub 타입으로 각각 나누는 형식으로 진행한다.
   - super, sub 테이블로 나눌 때 각각의 테이블에 따른 Join SQL 작성 - 각각의 객체 생성하는 등 복잡한 절차를 거치기 때문에 DB에 저장할 객체에는 상속 관계를 안 쓴다.

2. 연관 관계

   - 자바 컬렉션에서 CRUD를 진행할 경우, setItem()등 한 줄로 끝낼 수 있다.

   - 연관 관계를 설정할 때, 객체는 참조를 사용하며(member.getTeam()), 테이블은 외래 키를 사용한다.(JOIN ON M.TEAM_ID = T.TEAM_ID)

   - 이 때, 객체를 테이블에 맞춰 모델링을 하는 경우가 있는데 아래와 같이 FK 자체를 Long으로 저장하는 형식으로 사용하는 경우가 있다.

     ```JAVA
     class Member{
         String id;		 //Member_ID
         Long teamId; 	 //Team_ID FK 컬럼 사용
         String username; //Username 컬럼 사용
     }
     
     class Team{
         Long id;	//Team_ID PK 사용
         String name;//Name 컬럼 사용
     }
     ```

   - 하지만 객체는 참조로 연관 관계를 맺기 때문에 FK 대신 객체를 저장한다.

     ```java
     class Member{
         String id;			//Member_ID
         Team team;			//참조로 연관관계를 맺는다.
         String username;	//Username 컬럼 사용
         
         Team getTeam(){
             return team;
         }
     }
     ```

   - 하지만 위의 코드처럼 객체 다운 모델링을 했을 때는 객체엔 FK가 없기 때문에 Insert 진행 이 굉장히 어려워진다.

   - 또한 객체는 그래프처럼 자유롭게 객체 간 탐색이 자유로워야 한다. 하지만 실행하는 SQL에 따라 탐색 범위(테이블)가 결정되며, 이는 조회 시 객체 그래프 중 어떤 객체(Entity)는 Null이 되기 때문에 이는 Entity의 신뢰에 문제가 생긴다. 쿼리를 봐야 데이터가 어디까지 조회 되는지 확인하는 경우가 이 경우이다.

   - 그렇다고 모든 객체를 로딩 할 수 없다. 대량의 쿼리가 발생되며, 성능 또한 문제가 생기기 때문이다.

   - 이러한 문제 때문에 진정한 의미의 계층 분할이 어렵다. 또한 객체 답게 모델링 할수록, 매핑 작업만 늘어난다.

3. 데이터 타입

4. 데이터 식별 방법

객체를 자바 컬렉션에 저장 하듯이 DB에 저장할 수는 없을까? 저장 시 자동으로 쿼리를 생성해 주는 것이 없을까? 라는 질문에서 나온 해결 방안이 JPA이다.